import{d as S,i as H,o as y,c as C,r as V,j as k,u as p,k as I,t as A,b,f as G,F as O,C as U,l as X}from"./index.1c6a9837.js";import{_ as Y}from"./_plugin-vue_export-helper.a81e96fd.js";import{r as J,a as K}from"./PencilIcon.4791f507.js";var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_={},a=P&&P.__classPrivateFieldGet||function(s,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(s):i?i.value:t.get(s)},o,v,g,M,T,B,E,W,l;Object.defineProperty(_,"__esModule",{value:!0});var D=_.stoneFromColor=_.Stone=F=_.Goban=void 0,d;(function(s){s[s.None=0]="None",s[s.Black=1]="Black",s[s.White=2]="White"})(d||(d={}));_.Stone=d;function Q(s){switch(s){case"B":return d.Black;case"W":return d.White;case" ":return d.None}}D=_.stoneFromColor=Q;class Z{constructor(t,e,i=()=>{}){o.add(this),this.isPointerDown=!1,this.pointerCoordinates=null,this.lastMatrix=null,this.canvasSelector=t,this.size=e,this.onClick=i}initialize(){let t=a(this,o,"m",v).call(this);if(t===null)throw`Cannot locate ${this.canvasSelector}`;t.width=100*this.size,t.height=100*this.size,t.addEventListener("pointerdown",e=>{this.isPointerDown=!0,this.pointerCoordinates=a(this,o,"m",g).call(this,t,e),this.draw()}),t.addEventListener("pointerup",e=>{let{x:i,y:n}=a(this,o,"m",g).call(this,t,e);this.onClick(i,n),this.isPointerDown=!1,this.draw()}),t.addEventListener("pointercancel",e=>{this.isPointerDown=!1,this.draw()}),t.addEventListener("pointermove",e=>{this.isPointerDown&&(this.pointerCoordinates=a(this,o,"m",g).call(this,t,e),this.draw())})}draw(t){t?this.lastMatrix=t:this.lastMatrix&&(t=this.lastMatrix);let i=a(this,o,"m",v).call(this).getContext("2d");if(a(this,o,"m",M).call(this,i),a(this,o,"m",T).call(this,i),a(this,o,"m",B).call(this,i),a(this,o,"m",E).call(this,i),t)for(let n=0;n<this.size;n+=1)for(let r=0;r<this.size;r+=1)a(this,o,"m",W).call(this,i,t[n][r],n,r)}}var F=_.Goban=Z;o=new WeakSet,v=function(){return document.querySelector(this.canvasSelector)},g=function(t,e){return{x:Math.floor(this.size*e.offsetX/t.clientWidth),y:Math.floor(this.size*e.offsetY/t.clientHeight)}},M=function(t){let e=a(this,o,"m",v).call(this);t.fillStyle="#f4e5b8",t.fillRect(0,0,e.width,e.height)},T=function(t){t.lineWidth=4,t.strokeStyle="#000000";for(let e=0;e<this.size;e+=1)t.beginPath(),t.moveTo(100*e+50,48),t.lineTo(100*e+50,this.size*100-48),t.stroke();for(let e=0;e<this.size;e+=1)t.beginPath(),t.moveTo(50,100*e+50),t.lineTo(this.size*100-50,100*e+50),t.stroke()},B=function(t){if(this.size%2==0)return;t.fillStyle="#000000";const e=10;a(this,o,"m",l).call(this,t,this.size*50,this.size*50,e),this.size>=9&&this.size<13&&(a(this,o,"m",l).call(this,t,250,250,e),a(this,o,"m",l).call(this,t,this.size*100-250,250,e),a(this,o,"m",l).call(this,t,250,this.size*100-250,e),a(this,o,"m",l).call(this,t,this.size*100-250,this.size*100-250,e)),this.size>=13&&(a(this,o,"m",l).call(this,t,350,350,e),a(this,o,"m",l).call(this,t,this.size*100-350,350,e),a(this,o,"m",l).call(this,t,350,this.size*100-350,e),a(this,o,"m",l).call(this,t,this.size*100-350,this.size*100-350,e)),this.size>=15&&(a(this,o,"m",l).call(this,t,350,this.size*50,e),a(this,o,"m",l).call(this,t,this.size*100-350,this.size*50,e),a(this,o,"m",l).call(this,t,this.size*50,350,e),a(this,o,"m",l).call(this,t,this.size*50,this.size*100-350,e))},E=function(t){if(this.isPointerDown&&this.pointerCoordinates){t.strokeStyle="#ff0000";let{x:e,y:i}=this.pointerCoordinates;t.beginPath(),t.moveTo(0,i*100+50),t.lineTo(this.size*100,i*100+50),t.moveTo(e*100+50,0),t.lineTo(e*100+50,this.size*100),t.stroke()}},W=function(t,e,i,n){e!=d.None&&(e==d.Black&&(t.fillStyle="#000000"),e==d.White&&(t.fillStyle="#ffffff"),a(this,o,"m",l).call(this,t,100*i+50,100*n+50,48),e==d.White&&(t.strokeStyle="#000000",t.lineWidth=2,t.beginPath(),t.arc(100*i+50,100*n+50,48,0,Math.PI*2),t.stroke()))},l=function(t,e,i,n){t.beginPath(),t.arc(e,i,n,0,Math.PI*2),t.fill()};const x=S({props:{size:{type:Number,required:!0},matrix:{type:Array,required:!0},onClick:{type:Function,required:!0}},setup({size:s,matrix:t,onClick:e}){return{goban:new F("#goban",s,e)}},mounted(){this.goban.initialize(),H(()=>{let s=this.matrix.map(t=>t.map(e=>D(e)));this.goban.draw(s)})}}),tt={id:"goban",class:"mx-auto w-full h-full",style:{"max-width":"calc(100vh - 128px)","max-height":"calc(100vh - 128px)","aspect-ratio":"1 / 1"}};function et(s,t,e,i,n,r){return y(),C("canvas",tt)}const it=Y(x,[["render",et]]),st={key:1},ot={class:"flex items-center mx-auto",style:{"max-width":"calc(100vh - 128px)"}},rt=S({__name:"RecordView",props:{id:{type:Number,required:!0}},setup(s){const t=s;let{id:e}=t,i=new U,n=V(0),r=k([]);i.getRecord(e).then(u=>{n.value=u.board_size;for(let f=0;f<n.value;f+=1){let h=k([]);for(let c=0;c<n.value;c+=1)h.push(" ");r.push(h)}for(let{x:f,y:h,color:c}of u.stones)r[f][h]=c});async function $(u,f){i.playStone(e,u,f).then(({add:h,remove:c})=>{for(let m of h){let{x:w,y:z,color:R}=m;r[w][z]=R}for(let m of c){let{x:w,y:z}=m;r[w][z]=" "}})}async function N(){let{add:u,remove:f}=await i.undo(e);for(let h of u){let{x:c,y:m,color:w}=h;r[c][m]=w}for(let h of f){let{x:c,y:m}=h;r[c][m]=" "}}async function L(){await i.downloadRecord(e)}async function q(){X.push({name:"update",params:{id:e}})}async function j(){await i.pass(e)}return(u,f)=>(y(),C(O,null,[p(n)?(y(),I(it,{key:0,size:p(n),matrix:p(r),onClick:$},null,8,["size","matrix"])):(y(),C("div",st,"Loading game..."+A(p(n)),1)),b("div",ot,[b("button",{onClick:L,class:"rounded-md ring m-2"},[G(p(J),{class:"block h-8 w-8 m-2"})]),b("button",{onClick:q,class:"rounded-md ring m-2"},[G(p(K),{class:"block h-8 w-8 m-2"})]),b("button",{onClick:j,class:"grow m-2 h-12 rounded-md bg-red-600 text-gray-800"},"Pass"),b("button",{onClick:N,class:"grow m-2 h-12 rounded-md bg-yellow-600 text-gray-800"},"Undo")])],64))}});export{rt as default};
