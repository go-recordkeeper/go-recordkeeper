import{d as H,r as p,k as u,s as I,o as j,c as D,l as J,t as f,b as i,g as E,u as L,i as K,C as Q,m as M}from"./index.6fe06b20.js";import{G as U}from"./Goban.9cd62354.js";import{r as Z}from"./ArrowUturnLeftIcon.7f00155b.js";import{r as ee}from"./FlagIcon.5c5e9ff6.js";import"./_plugin-vue_export-helper.a81e96fd.js";const te={class:"mx-auto",style:{"max-width":"calc(100vh - 220px)"}},oe={key:1},se={class:"flex items-center"},ne={class:"text-2xl mx-2"},le={class:"flex items-center"},ie={class:"text-base mx-2"},ce={class:"text-base mx-2"},ae={class:"flex items-center"},re={class:"text-2xl mx-2"},ue={class:"flex items-center"},de={class:"text-base mx-2"},fe={class:"text-base mx-2"},ve={class:"text-base mx-2"},he={class:"flex items-center"},xe=K(" Save Result "),ke=H({__name:"ScoreRecordView",props:{id:{type:Number,required:!0}},setup(O){const T=O;function X(e){return e==="B"?"W":"B"}const V=new Q,s=p(0),z=p(0),m=p(0),_=p(0),k=p(0),b=p(0);function N(){return m.value+k.value}function S(){return z.value+_.value+b.value}const h=u([]),y=u([]),v=u([]),R=u([]);V.getRecord(T.id).then(e=>{z.value=e.komi,s.value=e.board_size;for(let t=0;t<s.value;t+=1){const o=u([]);for(let n=0;n<s.value;n+=1)o.push(" ");h.push(o);const l=u([]);for(let n=0;n<s.value;n+=1)l.push(" ");y.push(l);const c=u([]);for(let n=0;n<s.value;n+=1)c.push(null);v.push(c)}for(const{x:t,y:o,color:l}of e.stones)h[t][o]=l;for(const t of e.moves)t.color=="B"&&(m.value+=t.captures.length),t.color=="W"&&(_.value+=t.captures.length);Y(),q()});function*G(e,t){e>0&&(yield{x:e-1,y:t}),t>0&&(yield{x:e,y:t-1}),e<s.value-1&&(yield{x:e+1,y:t}),t<s.value-1&&(yield{x:e,y:t+1})}function Y(){for(let e=0;e<s.value;e+=1)for(let t=0;t<s.value;t+=1){const o=h[e][t];if(o===" "||v[e][t]!==null)continue;const l=u({color:o,dead:!1,stones:[]}),c=[{x:e,y:t}];for(;c.length>0;){const{x:n,y:a}=c.pop();l.stones.push({x:n,y:a}),v[n][a]=l;for(const{x:r,y:d}of G(n,a))h[r][d]===o&&!c.includes({x:r,y:d})&&v[r][d]===null&&c.push({x:r,y:d})}}}function g(e,t){return e+19*t}function P(e){return{x:e%19,y:Math.floor(e/19)}}function q(){k.value=0,b.value=0;const e=[];for(let t=0;t<s.value;t+=1){const o=u([]);for(let l=0;l<s.value;l+=1)o.push(null);e.push(o)}for(let t=0;t<s.value;t+=1)for(let o=0;o<s.value;o+=1){if(h[t][o]!==" "||e[t][o]!==null)continue;let c=0,n=0;const a=[],r=[g(t,o)];for(;r.length>0;){const{x:w,y:B}=P(r.pop());a.push(g(w,B));for(const{x,y:C}of G(w,B)){const W=v[x][C];W&&!W.dead?W.color==="B"?c+=1:W.color==="W"&&(n+=1):!r.includes(g(x,C))&&!a.includes(g(x,C))&&r.push(g(x,C))}}let d=" ";c==0&&n>=1&&(d="W",b.value+=a.length),n==0&&c>=1&&(d="B",k.value+=a.length);for(const w of a){const{x:B,y:x}=P(w);e[B][x]=d}}Object.assign(R,e)}I(R,()=>{for(let e=0;e<s.value;e+=1)for(let t=0;t<s.value;t+=1){const o=v[e][t],l=R[e][t];o&&o.dead?y[e][t]=X(o.color):l!==" "&&l!==null?y[e][t]=l:y[e][t]=" "}});function $(e,t){const o=v[e][t];o&&(o.dead=!o.dead,o.dead&&o.color=="B"&&(_.value+=o.stones.length),o.dead&&o.color=="W"&&(m.value+=o.stones.length),!o.dead&&o.color=="B"&&(_.value-=o.stones.length),!o.dead&&o.color=="W"&&(m.value-=o.stones.length)),q()}function A(){M.back()}async function F(){console.log("Saving");const e=await V.getRecord(T.id);S()>N()?e.winner="W":e.winner="B",await V.updateRecord(T.id,e),M.back()}return(e,t)=>(j(),D("div",te,[s.value?(j(),J(U,{key:0,size:s.value,matrix:h,decorations:y,onClick:$,style:{"max-width":"calc(100vh - 220px)","max-height":"calc(100vh - 220px)"}},null,8,["size","matrix","decorations"])):(j(),D("div",oe,"Loading game..."+f(s.value),1)),i("div",se,[i("div",ne,"Black: "+f(N()),1)]),i("div",le,[i("div",ie,f(m.value)+" captures",1),i("div",ce,f(k.value)+" territory",1)]),i("div",ae,[i("div",re,"White: "+f(S()),1)]),i("div",ue,[i("div",de,f(_.value)+" captures",1),i("div",fe,f(b.value)+" territory",1),i("div",ve,f(z.value)+" komi",1)]),i("div",he,[i("button",{onClick:A,class:"grow rounded-md ring m-2 bg-green-400 flex justify-center"},[E(L(Z),{class:"block h-7 w-7 m-2"})]),i("button",{onClick:F,class:"grow flex items-center rounded-md ring m-2 flex justify-center"},[E(L(ee),{class:"block h-7 w-7 m-2"}),xe])])]))}});export{ke as default};
